<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hidden Text Matcher</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#f0f9ff",
                100: "#e0f2fe",
                200: "#bae6fd",
                300: "#7dd3fc",
                400: "#38bdf8",
                500: "#0ea5e9",
                600: "#0284c7",
                700: "#0369a1",
                800: "#075985",
                900: "#0c4a6e",
              },
              secondary: {
                50: "#f8fafc",
                100: "#f1f5f9",
                200: "#e2e8f0",
                300: "#cbd5e1",
                400: "#94a3b8",
                500: "#64748b",
                600: "#475569",
                700: "#334155",
                800: "#1e293b",
                900: "#0f172a",
              },
            },
            animation: {
              "pulse-slow": "pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite",
              "bounce-slow": "bounce 2s infinite",
            },
          },
        },
      };
    </script>
    <style>
      /* Custom styles that can't be easily done with Tailwind */
      .hidden-text::selection {
        background-color: transparent;
        color: transparent;
      }

      .hidden-text:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.3);
      }

      @keyframes gradient-animation {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .gradient-bg {
        background: linear-gradient(-45deg, #0ea5e9, #0369a1, #0c4a6e, #075985);
        background-size: 400% 400%;
        animation: gradient-animation 15s ease infinite;
      }

      .typing-cursor {
        display: inline-block;
        width: 2px;
        height: 1em;
        background-color: currentColor;
        margin-left: 2px;
        animation: blink 1s step-end infinite;
      }

      @keyframes blink {
        from,
        to {
          opacity: 1;
        }
        50% {
          opacity: 0;
        }
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <div class="gradient-bg text-white py-6 shadow-md">
      <div class="container mx-auto px-4">
        <h1 class="text-3xl font-bold text-center">Hidden Text Matcher</h1>
        <p class="text-center mt-2 opacity-90">
          Type the hidden text to see how well you match
        </p>
      </div>
    </div>

    <main class="container mx-auto px-4 py-8 max-w-5xl">
      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="p-6 md:p-8">
          <div class="flex flex-col md:flex-row gap-8">
            <!-- Image Container -->
            <div class="md:w-1/2 flex flex-col">
              <h2 class="text-xl font-semibold mb-4 text-secondary-800">
                Challenge Image
              </h2>
              <div
                class="rounded-lg overflow-hidden bg-secondary-100 p-2 flex-grow flex items-center justify-center"
              >
                <img
                  src="https://i.ibb.co/j9M1sd7F/image.png"
                  alt="Text Matcher Challenge"
                  class="w-full h-auto rounded-lg max-w-md mx-auto shadow-sm transition-transform duration-300 hover:scale-[1.02]"
                />
              </div>
              <div
                class="mt-4 bg-primary-50 p-4 rounded-lg border border-primary-100"
              >
                <h3 class="font-medium text-primary-800 flex items-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5 mr-2"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  How it works
                </h3>
                <p class="text-primary-700 text-sm mt-1">
                  Look at the image and try to type the text you think is
                  hidden. The system will calculate how closely your text
                  matches the hidden content.
                </p>
              </div>
            </div>

            <!-- Input Container -->
            <div class="md:w-1/2 flex flex-col">
              <h2 class="text-xl font-semibold mb-4 text-secondary-800">
                Your Response
              </h2>

              <div class="relative mb-2">
                <div
                  class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-30"
                  id="placeholderText"
                >
                  <div class="flex items-center text-secondary-400">
                    <span>Start typing here</span>
                    <span class="typing-cursor"></span>
                  </div>
                </div>
                <textarea
                  id="hiddenInput"
                  placeholder=""
                  class="hidden-text w-full h-48 p-4 border border-secondary-200 rounded-lg mb-4 bg-transparent text-transparent resize-none focus:border-primary-400 transition-all duration-300"
                  style="caret-color: transparent"
                  aria-label="Hidden text input area"
                ></textarea>
              </div>

              <div class="text-right mb-4">
                <span id="charCount" class="text-sm text-secondary-500"
                  >0 characters</span
                >
              </div>

              <button
                id="submitBtn"
                class="w-full bg-primary-600 hover:bg-primary-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-300 flex items-center justify-center"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5 mr-2"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z"
                    clip-rule="evenodd"
                  />
                </svg>
                Submit
              </button>

              <div
                id="resultContainer"
                class="mt-6 p-5 bg-secondary-50 rounded-lg border border-secondary-200 hidden"
              >
                <h3 class="font-semibold text-secondary-800 mb-2">Result</h3>
                <div id="resultContent" class="flex flex-col items-center">
                  <div
                    id="resultCircle"
                    class="w-24 h-24 rounded-full flex items-center justify-center text-white font-bold text-xl mb-3 bg-primary-600"
                  >
                    0%
                  </div>
                  <p id="result" class="text-center text-secondary-700"></p>
                </div>
              </div>

              <div
                id="loadingIndicator"
                class="mt-6 p-5 bg-secondary-50 rounded-lg border border-secondary-200 hidden"
              >
                <div class="flex flex-col items-center">
                  <div
                    class="inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-primary-600"
                  ></div>
                  <p class="mt-3 text-secondary-700">Analyzing your text...</p>
                </div>
              </div>

              <div
                id="errorContainer"
                class="mt-6 p-5 bg-red-50 rounded-lg border border-red-200 hidden"
              >
                <div class="flex items-start">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5 text-red-500 mt-0.5 mr-2"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  <div>
                    <h3 class="font-semibold text-red-800">Error</h3>
                    <p id="errorMessage" class="text-red-700 mt-1">
                      Something went wrong. Please try again.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-8 text-center text-secondary-500 text-sm">
        <p>Â© 2023 Hidden Text Matcher. All rights reserved.</p>
      </div>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const hiddenInput = document.getElementById("hiddenInput");
        const submitBtn = document.getElementById("submitBtn");
        const result = document.getElementById("result");
        const resultCircle = document.getElementById("resultCircle");
        const resultContainer = document.getElementById("resultContainer");
        const loadingIndicator = document.getElementById("loadingIndicator");
        const errorContainer = document.getElementById("errorContainer");
        const errorMessage = document.getElementById("errorMessage");
        const placeholderText = document.getElementById("placeholderText");
        const charCount = document.getElementById("charCount");

        // Hide placeholder when typing starts
        hiddenInput.addEventListener("input", function () {
          if (hiddenInput.value.length > 0) {
            placeholderText.classList.add("hidden");
          } else {
            placeholderText.classList.remove("hidden");
          }

          // Update character count
          charCount.textContent = `${hiddenInput.value.length} character${
            hiddenInput.value.length !== 1 ? "s" : ""
          }`;
        });

        // Prevent selection being visible
        hiddenInput.addEventListener("select", function (e) {
          e.target.selectionStart = e.target.selectionEnd;
        });

        // Reset UI state
        function resetUI() {
          resultContainer.classList.add("hidden");
          loadingIndicator.classList.add("hidden");
          errorContainer.classList.add("hidden");
        }

        // Set result color based on score
        function setResultColor(score) {
          let bgColor;
          if (score >= 90) {
            bgColor = "bg-green-600";
          } else if (score >= 70) {
            bgColor = "bg-green-500";
          } else if (score >= 50) {
            bgColor = "bg-yellow-500";
          } else if (score >= 30) {
            bgColor = "bg-orange-500";
          } else {
            bgColor = "bg-red-500";
          }

          resultCircle.className = `w-24 h-24 rounded-full flex items-center justify-center text-white font-bold text-xl mb-3 ${bgColor}`;
        }

        // Display feedback based on score
        function getFeedbackText(score) {
          if (score >= 90) {
            return "Excellent! Nearly perfect match.";
          } else if (score >= 70) {
            return "Great job! Very close match.";
          } else if (score >= 50) {
            return "Good effort! You're on the right track.";
          } else if (score >= 30) {
            return "Keep trying! You've got some matching words.";
          } else {
            return "Try again! Your text doesn't match very well.";
          }
        }

        submitBtn.addEventListener("click", async function () {
          const userText = hiddenInput.value.trim();

          if (!userText) {
            errorMessage.innerText =
              "Please enter some text before submitting.";
            errorContainer.classList.remove("hidden");
            return;
          }

          // Reset UI and show loading
          resetUI();
          loadingIndicator.classList.remove("hidden");

          try {
            // Call the Django backend API
            const response = await fetch("/Api/compare-text/", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": getCsrfToken(), // Django CSRF token
              },
              body: JSON.stringify({ user_text: userText }),
            });

            if (!response.ok) {
              throw new Error(
                `Server responded with status: ${response.status}`
              );
            }

            const data = await response.json();
            const similarity = data.similarity;

            // Update the result circle with the score
            resultCircle.textContent = `${Math.round(similarity)}%`;
            setResultColor(similarity);

            // Set feedback text
            result.innerText = getFeedbackText(similarity);

            // Show result container
            loadingIndicator.classList.add("hidden");
            resultContainer.classList.remove("hidden");
          } catch (error) {
            console.error("Error:", error);
            loadingIndicator.classList.add("hidden");
            errorMessage.innerText = "Error comparing text. Please try again.";
            errorContainer.classList.remove("hidden");
          }
        });

        // Get Django CSRF token from cookie
        function getCsrfToken() {
          const name = "csrftoken";
          let cookieValue = null;
          if (document.cookie && document.cookie !== "") {
            const cookies = document.cookie.split(";");
            for (let i = 0; i < cookies.length; i++) {
              const cookie = cookies[i].trim();
              if (cookie.substring(0, name.length + 1) === name + "=") {
                cookieValue = decodeURIComponent(
                  cookie.substring(name.length + 1)
                );
                break;
              }
            }
          }
          return cookieValue;
        }

        // Add keyboard shortcut (Ctrl+Enter or Cmd+Enter) to submit
        hiddenInput.addEventListener("keydown", function (e) {
          if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
            submitBtn.click();
          }
        });

        // Add animation to the submit button on hover
        submitBtn.addEventListener("mouseenter", function () {
          this.classList.add("scale-105");
        });

        submitBtn.addEventListener("mouseleave", function () {
          this.classList.remove("scale-105");
        });
      });
    </script>
  </body>
</html>
